# =============================================================================
# Algo-Trade Platform - Environment Variables Template
# =============================================================================
#
# CRITICAL SECURITY NOTICE:
# 1. NEVER commit the actual .env file to version control
# 2. This is a TEMPLATE file - copy it to .env and fill in real values
# 3. Keep your .env file secure with proper file permissions (chmod 600 .env)
# 4. Use Vault for production secrets (see VAULT configuration below)
# 5. Rotate all secrets regularly (recommended: every 90 days minimum)
#
# Quick Start:
#   cp .env.example .env
#   chmod 600 .env
#   # Edit .env with your actual credentials
# =============================================================================

# -----------------------------------------------------------------------------
# IBKR (Interactive Brokers) Configuration
# -----------------------------------------------------------------------------
# Interactive Brokers API credentials and connection settings
# Get these from: https://www.interactivebrokers.com/
#
# SECURITY: These credentials provide direct access to trading accounts
# RISK LEVEL: CRITICAL
# -----------------------------------------------------------------------------

# IBKR Connection
IBKR_HOST=127.0.0.1
IBKR_PORT=7497                    # Paper Trading: 7497, Live Trading: 7496
IBKR_CLIENT_ID=100                # Unique client ID (1-9999)
IBKR_TIMEOUT=30                   # Connection timeout in seconds

# IBKR Credentials (if using IB Gateway with authentication)
# Leave empty if using TWS (Trader Workstation)
IBKR_USERNAME=                    # Your IB username (REQUIRED for production)
IBKR_PASSWORD=                    # Your IB password (REQUIRED for production)

# Trading Mode
IBKR_PAPER_TRADING=true           # true = Paper Trading, false = LIVE (BE CAREFUL!)

# Reconnection Settings
IBKR_RECONNECT_ATTEMPTS=5
IBKR_RECONNECT_BACKOFF=1,2,4,8,16 # Exponential backoff in seconds

# -----------------------------------------------------------------------------
# Data Plane Configuration
# -----------------------------------------------------------------------------
# Data source and market data settings
# -----------------------------------------------------------------------------

DP_DATA_PROVIDER=local            # Options: local, ibkr, polygon, alpaca
DP_CACHE_PATH=data/cache          # Local cache directory for market data
DP_HISTORICAL_WINDOW_DAYS=1095    # 3 years of historical data (365 * 3)
DP_ASSETS_FILE=data/assets.csv    # Path to assets/universe configuration

# Data Plane Broker Settings (mirrors IBKR for consistency)
DP_BROKER__NAME=IBKR
DP_BROKER__HOST=${IBKR_HOST}
DP_BROKER__PORT=${IBKR_PORT}
DP_BROKER__USERNAME=${IBKR_USERNAME}
DP_BROKER__PASSWORD=${IBKR_PASSWORD}
DP_BROKER__PAPER=${IBKR_PAPER_TRADING}

# Execution Settings
DP_EXECUTION__ENABLED=false       # Enable actual order execution (set to true for live)
DP_EXECUTION__DEFAULT_SLIPPAGE=0.001
DP_EXECUTION__MAX_POSITION_RISK=0.05

# -----------------------------------------------------------------------------
# Kafka Message Bus
# -----------------------------------------------------------------------------
# Apache Kafka configuration for inter-service communication
# -----------------------------------------------------------------------------

KAFKA_BOOTSTRAP_SERVERS=localhost:9092
KAFKA_TOPICS_PREFIX=algo_trade    # Prefix for all topics (e.g., algo_trade.market_events)

# Kafka Authentication (for production)
KAFKA_SECURITY_PROTOCOL=PLAINTEXT # Options: PLAINTEXT, SASL_SSL, SASL_PLAINTEXT
KAFKA_SASL_MECHANISM=             # Options: PLAIN, SCRAM-SHA-256, SCRAM-SHA-512
KAFKA_SASL_USERNAME=              # Required if SASL enabled
KAFKA_SASL_PASSWORD=              # Required if SASL enabled (SENSITIVE!)

# Kafka SSL/TLS (for encrypted communication)
KAFKA_SSL_CAFILE=                 # Path to CA certificate
KAFKA_SSL_CERTFILE=               # Path to client certificate
KAFKA_SSL_KEYFILE=                # Path to client private key (SENSITIVE!)
KAFKA_SSL_PASSWORD=               # Private key password (SENSITIVE!)

# -----------------------------------------------------------------------------
# HashiCorp Vault Integration
# -----------------------------------------------------------------------------
# Use Vault for centralized secrets management in production
# Documentation: https://www.vaultproject.io/
# -----------------------------------------------------------------------------

# Enable Vault (recommended for production)
DP_USE_VAULT=0                    # 1 = Enable Vault, 0 = Use local env vars

# Vault Server Configuration
VAULT_ADDR=                       # e.g., https://vault.example.com:8200
VAULT_TOKEN=                      # Vault authentication token (SENSITIVE!)
VAULT_NAMESPACE=                  # Vault namespace (for Enterprise)

# Vault Secret Paths
DP_VAULT_PATH=secret/data/algo-trade/broker        # Path to broker credentials
DP_VAULT_PATH_PASSWORD=secret/data/algo-trade/passwords  # Path to passwords

# Vault Auth Methods (alternatives to token)
VAULT_ROLE_ID=                    # For AppRole auth
VAULT_SECRET_ID=                  # For AppRole auth (SENSITIVE!)

# -----------------------------------------------------------------------------
# AWS Secrets Manager (alternative to Vault)
# -----------------------------------------------------------------------------
# Use AWS Secrets Manager for cloud-native deployments
# -----------------------------------------------------------------------------

USE_AWS_SECRETS_MANAGER=0         # 1 = Enable AWS Secrets Manager
AWS_REGION=us-east-1              # AWS region for Secrets Manager
AWS_SECRET_NAME=algo-trade/production  # Secret name in AWS

# AWS Credentials (prefer IAM roles over static credentials)
AWS_ACCESS_KEY_ID=                # AWS access key (NOT RECOMMENDED - use IAM roles)
AWS_SECRET_ACCESS_KEY=            # AWS secret key (SENSITIVE! - use IAM roles)

# -----------------------------------------------------------------------------
# Monitoring & Observability
# -----------------------------------------------------------------------------

# Prometheus Metrics
PROMETHEUS_PORT=9090
PROMETHEUS_METRICS_PORT=8000      # Port for application metrics export

# Grafana
GRAFANA_PORT=3000
GRAFANA_ADMIN_USER=admin
GRAFANA_ADMIN_PASSWORD=           # Change this! (SENSITIVE!)

# Logging
LOG_LEVEL=WARNING                 # DEBUG, INFO, WARNING, ERROR, CRITICAL
LOG_FORMAT=json                   # json, text
LOG_FILE=logs/algo_trade.log

# Sentry Error Tracking (optional)
SENTRY_DSN=                       # Sentry DSN for error tracking (SENSITIVE!)
SENTRY_ENVIRONMENT=development    # development, staging, production

# -----------------------------------------------------------------------------
# Database (if used for persistence)
# -----------------------------------------------------------------------------

# PostgreSQL
POSTGRES_HOST=localhost
POSTGRES_PORT=5432
POSTGRES_DB=algo_trade
POSTGRES_USER=                    # Database user
POSTGRES_PASSWORD=                # Database password (SENSITIVE!)

# Redis (for caching)
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=                   # Redis password (SENSITIVE!)
REDIS_DB=0

# -----------------------------------------------------------------------------
# Security & Encryption
# -----------------------------------------------------------------------------

# Master Encryption Key (for encrypting local secrets at rest)
# Generate with: python -c "from cryptography.fernet import Fernet; print(Fernet.generate_key().decode())"
MASTER_ENCRYPTION_KEY=            # Fernet key (CRITICAL SENSITIVE!)

# Secret Rotation
SECRET_ROTATION_ENABLED=true
SECRET_ROTATION_DAYS=90           # Rotate secrets every 90 days

# API Keys for external services
POLYGON_API_KEY=                  # Polygon.io API key (if using)
ALPACA_API_KEY=                   # Alpaca API key (if using)
ALPACA_SECRET_KEY=                # Alpaca secret key (SENSITIVE!)

# Webhook Secrets (for incoming webhooks)
WEBHOOK_SECRET=                   # Shared secret for webhook validation (SENSITIVE!)

# -----------------------------------------------------------------------------
# Application Settings
# -----------------------------------------------------------------------------

# Environment
ENVIRONMENT=development           # development, staging, production
DEBUG=false                       # NEVER set to true in production!

# Configuration Files
DATA_PLANE_CONFIG=config/data_plane.yaml
TARGETS_CONFIG=targets.yaml

# Feature Flags
ENABLE_PAPER_TRADING=true
ENABLE_LIVE_TRADING=false         # DANGEROUS - requires explicit enablement
ENABLE_DRY_RUN=true               # Simulate trades without execution

# Risk Limits (additional env overrides)
RISK_KILL_PNL=-0.05               # Kill switch at -5% PnL
RISK_MAX_DRAWDOWN=0.15            # Max drawdown 15%
RISK_PSR_THRESHOLD=0.20           # Probabilistic Sharpe Ratio threshold

# -----------------------------------------------------------------------------
# Development & Testing
# -----------------------------------------------------------------------------

# Test Secrets (for CI/CD and local testing only)
TEST_IBKR_HOST=127.0.0.1
TEST_IBKR_PORT=7497
TEST_MODE=false                   # Enable test mode

# CI/CD Settings
CI=false                          # Set by CI/CD systems automatically
DP_ALLOW_CONFIG_WRITE=0           # Allow config file writing (1 = yes, 0 = no)

# -----------------------------------------------------------------------------
# SECURITY CHECKLIST
# -----------------------------------------------------------------------------
# Before deploying to production, ensure:
#
# [ ] All SENSITIVE values are filled with real credentials
# [ ] .env file permissions are set to 600 (chmod 600 .env)
# [ ] .env is in .gitignore (already done)
# [ ] Vault or AWS Secrets Manager is configured (DP_USE_VAULT=1)
# [ ] MASTER_ENCRYPTION_KEY is generated and stored securely
# [ ] All default passwords (Grafana, Postgres, Redis) are changed
# [ ] IBKR_PAPER_TRADING is set appropriately (true for testing)
# [ ] LOG_LEVEL is set to WARNING or ERROR in production
# [ ] ENABLE_LIVE_TRADING is explicitly enabled only when ready
# [ ] Secrets rotation is enabled (SECRET_ROTATION_ENABLED=true)
# [ ] TLS/SSL is configured for Kafka in production
# [ ] Sentry or similar error tracking is configured
# [ ] All API keys are from production services (not test keys)
#
# =============================================================================
# END OF CONFIGURATION
# =============================================================================
